<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>euler1415's Website</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@2.x/dist/index.umd.js"></script>
</head>

<body>
    <header>
        <h1>Welcome to My Site! I hope I get a lot of views!!!</h1>
        <p>Website Views: <span id="view-count">Loading...</span></p>
    </header>

    <main>
        <section id="suggestions">
            <h2>If you want to give me some suggestions for my website, then PM me, euler1415 on AoPS (user 1130504). I
                probably won't respond, but I will edit this website!!!</h2>
        </section>
        <section id="important-links">
            <h2>Links that I guess that I am advertising.</h2>
            <h3><em><span class="blink-css">Shout out to AoPS and a bunch of AoPS users!!</span></em></h3>

            <ul>
                <span class="blink-css">
                    <li><em><a href="https://dashboard.blooket.com/set/6835caa7b7e9c50772e0ed77"
                                target="This thingy">Visit this Link</a></em></li>
                </span>
                <span class="blink-css">
                    <li><em><a href="https://artofproblemsolving.com/community/user/1130504"
                                target="This other thingy">Check out Another Link</a></em></li>
                </span>
                <span class="blink-css">
                    <li><em><a href="https://artofproblemsolving.com/alcumus/problem" target="This other thingy">Check
                                out Another Link</a></em></li>
                </span>
                <span class="blink-css">
                    <li><em><a href="https://hmpg.net/" target="This other thingy">Check out Another Link(I know, a lot
                                of links)</a></em></li>
                </span>
            </ul>
        </section>
        <section id="chat-room">
            <h2>Chat Room</h2>
            <div id="chat-messages">
            </div>
            <input type="text" id="chat-input" placeholder="Type your message...">
            <button id="send-button">Send</button>
        </section>
        <section id="rubiks-cube">
            <h1>CFOP algorithms</h1>
            <h2>F2L algorithms</h2>
            <img class="img-max-width small-hide" src="https://cdn.shopify.com/s/files/1/0703/2389/6537/files/gancube-classroom-3x3cfop-2.webp?v=1740620242" alt="Gancube">
            <h2>OLL algorithms</h2>
            <img class="img-max-width small-hide" src="https://cdn.shopify.com/s/files/1/0703/2389/6537/files/gancube-classroom-3x3cfop-3.webp?v=1740620242" alt="Gancube">
            <h2>PLL algorithms</h2>
            <img class="img-max-width small-hide" src="https://cdn.shopify.com/s/files/1/0703/2389/6537/files/gancube-classroom-3x3cfop-5.webp?v=1740620242" alt="Gancube">
            <section id="latex">
            <h2>Here you will learn LaTeX.</h2>
                <a>The first thing that we are going to learn is the \dfrac{}{} command in LaTeX.
                In LaTeX, if you want to write a fraction, such as x/y, you would write \dfrac{x}{y}.</a>
                <a>The next thing that we are going to learn is the \sqrt{} command in LaTeX.
                In LaTeX, if you want to write a square root, such as square root of x, you would write \sqrt{x}.</a>
            <h2>Completely random facts that no one cares about!</h2>
                <li>No number before 1,000 contains the letter A.</li>
                <li>There were active volcanoes on the moon when dinosaurs were alive</li>
                <li>Sudan has more pyramids than any country in the world.</li>
                <li>The human circulatory system is more than 60,000 miles long.</li>
                <li>The Pope can't be an organ donor.</li>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js"
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js"
        import { serverTimestamp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js"
        import { Timestamp, getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js"

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDPN5czgwm9NPwVG2yu_KNKk63Ggqko5uc",
            authDomain: "webpage-ccd22.firebaseapp.com",
            projectId: "webpage-ccd22",
            storageBucket: "webpage-ccd22.firebasestorage.app",
            messagingSenderId: "211531738009",
            appId: "1:211531738009:web:bbc8179a4b43770976c108",
            measurementId: "G-FQQ0R01TDZ"
        };

        // Initialize Firebase
        console.log(firebaseConfig)
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);


        // 1. Import the necessary Firestore functions
        const db = getFirestore(app); // Changed to getFirestore(app)
        console.log(`db ${db}`)

        // 4. Function to write a new message
        async function writeNewMessage(username, messageText) {
            try {
                // Specify the collection where you want to add the document
                const messagesCollection = collection(db, "messages"); // We'll use 'messages' as the collection name

                // Add a new document to the 'messages' collection
                const docRef = await addDoc(messagesCollection, {
                    text: messageText, // The content of the message
                    timestamp: serverTimestamp(), // Use a server timestamp for consistency
                    username: username,
                });

                console.log("Document written with ID: ", docRef.id);
                // Trigger fireworks on successful message write
                triggerFireworks();
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        }

        // Removed the standalone writeNewMessage('You', 'A message') call here
        // as it would trigger fireworks on page load unnecessarily.

        async function readAll() {
            const q = query(collection(db, "messages"));
            const snapshot = await getDocs(q);
            return snapshot.docs.map(doc => {
                const data = doc.data();
                // Convert Firestore Timestamp to JavaScript Date object for display
                if (data.timestamp && typeof data.timestamp.toDate === 'function') {
                    data.timestamp = data.timestamp.toDate().getTime();
                }
                return data;
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const viewCountElement = document.getElementById('view-count');
            const chatMessagesElement = document.getElementById('chat-messages');
            const chatInputElement = document.getElementById('chat-input');
            const sendButtonElement = document.getElementById('send-button');

            // --- View Counter (Still needs a backend to be truly persistent and accurate) ---
            async function fetchAndUpdateViewCount() {
                try {
                    let currentViews = localStorage.getItem('simulatedViews');
                    if (!sessionStorage.getItem('viewIncremented')) { // Increment once per session
                        currentViews = currentViews ? parseInt(currentViews) + 1 : 1;
                        localStorage.setItem('simulatedViews', currentViews);
                        sessionStorage.setItem('viewIncremented', 'true');
                    } else {
                        currentViews = currentViews ? parseInt(currentViews) : 0;
                    }
                    viewCountElement.textContent = currentViews || '0';

                } catch (error) {
                    console.error('Error with view count:', error);
                    viewCountElement.textContent = 'Error';
                }
            }
            fetchAndUpdateViewCount();

            // --- Chat Room with Backend Persistence ---

            function getRandomInt(min, max) {
                min = Math.ceil(min);
                max = Math.floor(max);
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            // Helper function to display a message
            function displayMessage(user, message, timestamp) {
                const messageElement = document.createElement('div');
                const timeString = timestamp ? new Date(timestamp).toLocaleTimeString() : '';
                messageElement.innerHTML = `${timeString ? `<span class="timestamp">[${timeString}]</span> ` : ''}<strong>${user}:</strong> ${message}`;
                chatMessagesElement.appendChild(messageElement);
                chatMessagesElement.scrollTop = chatMessagesElement.scrollHeight;
            }

            async function loadInitialMessages() {
                try {
                    const messages = await readAll();
                    messages.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0)); // Sort by timestamp
                    messages.forEach(msg => {
                        displayMessage(msg.username, msg.text, msg.timestamp);
                    });
                    displayMessage('System', 'Chat connected.');

                } catch (error) {
                    console.error("Error loading initial messages:", error);
                    displayMessage('System', 'Could not load previous messages.');
                }
            }

            // **4. Send a new message**
            sendButtonElement.addEventListener('click', () => {
                const messageText = chatInputElement.value.trim();
                if (messageText) {
                    displayMessage('You', messageText, Date.now()); // Optimistic update
                    writeNewMessage('You', messageText); // Call writeNewMessage with fixed 'You' username
                    chatInputElement.value = '';
                }
            });

            chatInputElement.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    sendButtonElement.click();
                }
            });

            // Initialize
            loadInitialMessages();

            // --- Firework Animation Setup ---
            // Create a container for the fireworks
            const fireworksContainer = document.createElement('div');
            fireworksContainer.id = 'fireworks-container';
            Object.assign(fireworksContainer.style, {
                position: 'fixed',
                top: 0,
                left: 0,
                width: '100%',
                height: '100%',
                zIndex: 9999, // Ensure it's on top
                pointerEvents: 'none' // Allows clicking through the container
            });
            document.body.appendChild(fireworksContainer);

            // Initialize fireworks after the container is in the DOM
            const fireworks = new Fireworks.default(fireworksContainer, {
                autoresize: true,
                opacity: 0.5,
                acceleration: 1.05,
                friction: 0.97,
                gravity: 1.5,
                particles: 50,
                trace: 3,
                traceSpeed: 10,
                explode: 5,
                mouse: {
                    click: false,
                    move: false,
                    max: 1
                },
                sound: {
                    enabled: false,
                }
            });

            function triggerFireworks() {
                fireworks.start();
                setTimeout(() => {
                    fireworks.stop();
                }, 3000); // Stop fireworks after 3 seconds
            }
        });
    </script>
</body>

</html>
